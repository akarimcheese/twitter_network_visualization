<!doctype html>
<html>
  <head>
    <title>Crystal Twitter Networks</title>
    <link rel="stylesheet" href="style/main.css">
    
    <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
    <script src="js/network.js"></script>
    
    <script>
      $(document).ready(function() {
        let twitter_network = new Graph(document.getElementsByTagName('svg')[0]);
        twitter_network.startForces();
          
        // Open WebSocket connection
        var ws = new WebSocket("wss://" + location.host + "/events");
        // Append each message
        ws.onmessage = function(e) { 
            
            console.log(e.data);
            let data = JSON.parse(e.data);
            $('#websocketlog').append(e.data + "\n") ;
            console.log(data);
            
            if (data.node) {
                twitter_network.addNode(data.node, data.img);
            } else if (data.source) {
                twitter_network.addEdge(data.source, data.target);
            } else if (data.message) {
                console.log(data.message);
            }
        };
        $("form").bind('submit', function(e) {
          var message = $('#msg').val();
          ws.send(message);
          $('#msg').val(''); $('#msg').focus();
          e.preventDefault();
        });
        window.onbeforeunload = function() {
          websocket.onclose = function () {}; // disable onclose handler first
          websocket.close()
        };
      });
    </script>
  </head>
  <body>
    <svg width="100%" height="100%">
        <defs>
        </defs>
        
        <rect x="0" y="0" width="100%" height="100%" fill="#DFE1E1"/>
        <g id="edges"></g>
        <g id="surges"></g>
        <g id="nodes"></g>
    </svg>
    
    <div id="interface">
      <pre id='websocketlog'></pre>
      <form>
        <input id='msg' />
        <input type="submit" value="Send">
      </form>
    </div>
  </body>
</html>