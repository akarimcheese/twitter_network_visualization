<!doctype html>
<html>
  <head>
    <title>Crystal Twitter Networks</title>
    <link rel="stylesheet" href="style/main.css">
    
    <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
    <script src="js/network.js"></script>
    
    <script>
        
      $(document).ready(function() {
        let twitter_network = new Graph(document.getElementsByTagName('svg')[0]);
        twitter_network.startForces();
          
        // Open WebSocket connection
        var ws = new WebSocket("wss://" + location.host + "/events");
        // Append each message
        ws.onmessage = function(e) { 
            
            console.log(e.data);
            let data = JSON.parse(e.data);
            $('#websocketlog').append(e.data + "\n") ;
            console.log(data);
            
            if (data.node) {
                twitter_network.addNode(data.node, data.img);
            } else if (data.source) {
                twitter_network.addEdge(data.source, data.target);
            } else if (data.message) {
                console.log(data.message);
            }
        };
        $("form").bind('submit', function(e) {
          var message = $('#msg').val().trim();
          ws.send(message);
          $('#msg').val(''); $('#msg').focus();
          e.preventDefault();
        });
        window.onbeforeunload = function() {
          websocket.onclose = function () {}; // disable onclose handler first
          websocket.close()
        };
        
        $('input[type=radio][name=graphMode]').change(function () {
            if (this.value == 'circle') {
                twitter_network.startCircle();
            }
            else if (this.value == 'force') {
                twitter_network.startForces();
            }
        });
      });
      
      
    </script>
  </head>
  <body>
    <svg width="100%" height="100%">
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="6" 
    refX="0" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6"/>
          </marker>
        </defs>
        
        <rect x="0" y="0" width="100%" height="100%" fill="#DFE1E1"/>
        <g id="edges"></g>
        <g id="nodes"></g>
    </svg>
    
    <div id="interface">
      <form>
        <input id='msg' />
        <input type="submit" value="Send">
      </form>
      <div id='graphMode'>
        <h4>Graph Mode</h4>
        <input type='radio' name='graphMode' value='force' checked>Force Directed<br>
        <input type='radio' name='graphMode' value='circle'>Circle<br>
      </div>
      <div>
        <h4>Websocket Logs</h4>
        <pre id='websocketlog'></pre>
      </div>
    </div>
  </body>
</html>